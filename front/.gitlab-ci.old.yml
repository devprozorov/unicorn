stages:
  - deploy

deploy_prod:
  stage: deploy
  tags:
    - dev1
  only:
    - main

  script:
    - echo "üöÄ Deploy Unicorn Nuxt"

    # 1. –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–¥ –≤ —Ä–∞–±–æ—á—É—é –ø–∞–ø–∫—É
    - rm -rf /home/gitlab-runner/unicorn
    - mkdir -p /home/gitlab-runner/unicorn
    - cp -r . /home/gitlab-runner/unicorn

    # 2. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É –¥–µ–ø–ª–æ—è
    - cd /home/gitlab-runner/unicorn

    # 3. Docker deploy
    - docker compose down
    - docker compose build
    - docker compose up -d

    # 4. –û—á–∏—Å—Ç–∫–∞
    - docker image prune -f
